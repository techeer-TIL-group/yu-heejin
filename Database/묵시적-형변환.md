## 묵시적 형변환

- 묵시적 형변환이란 **조건절 데이터 타입이 다르면 우선순위가 있는 쪽으로 형변환이 내부적으로 발생하는 것을 의미한다.**
    - 예를 들어, 정수 값과 문자열을 비교하는 경우, 숫자가 문자열보다 우선 순위에 있기 때문에 문자열은 정수값으로 자동 형변환된다.
- 묵시적 형변환은 예외를 DBMS 내부적으로 처리하기 위함이므로, 서비스 도중 언제든 발생할 수 있다.
- 만약 묵시적 형변환이 일어나는 곳이 인덱스 컬럼이라면, 인덱스가 있을지라도 조건절을 처리하기 위해 모든 데이터를 묵시적으로 형변환하기 때문에 인덱스가 무의미해지며, 풀 테이블 스캔이 발생한다.

## 명시적 형변환과 묵시적 형변환

- 만약 데이터 타입이 맞지 않은 경우 TO_NUMBER, TO_CHAR 등의 명시적 형변환을 통해 정확한 데이터를 입력해야한다.
- 하지만 종종 데이터 타입이 맞지 않더라도 자동으로 형변환하여 데이터를 입력해주기도 하는데, 이를 묵시적 형변환이라고 한다.

### 명시적 형변환

```sql
INSERT INTO TABLE(DATE, EMPL_NO)
VALUES (TO_DATE('20221202', 'YYYY/MM/DD'), TO_CHAR(100));
```

- 명시적 형변환은 말 그대로 문장에서 형변환을 직접적으로 표기해준다.

### 묵시적 형변환

```sql
INSERT INTO TABLE(DATE, EMPL_NO)
VALUES ('2022-10-24', 100);
```

- 위 SQL 문장에서 DATE의 경우 문자열 형식으로 입력되었으나, 형태가 YYYY-MM-DD로 자동 형변환 되었다.
- EMPL_NO 역시 NUMBER 형식으로 입력되었으나, 형태가 문자열로 자동 형변환 되었다.
- 명시적 형변환을 하지 않더라도 **RDBMS에서 처리할 수 있는 타입이 입력된다면 자동으로 데이터 타입을 변환하여 입력된다.**

## 묵시적 형변환 테스트

다음과 같은 테이블이 있다고 가정하자.

```sql
+--------+------------+----------------+---------------------+
| i      | j          | s              | d                   |
+--------+------------+----------------+---------------------+
| 122416 | 3835333344 | 17424528721665 | 2000-01-16 13:59:59 |
+--------+------------+----------------+---------------------+
```

### 정수 칼럼을 문자열로 검색

```sql
explain 
select * from test
where j = '3835333344';
```

- 위 테이블에서 j는 정수형이다.
- 우선 순위가 정수형이 높기 때문에 문자열 조건 값은 묵시적으로 정수형으로 형변환되므로 실행시 문제가 되지 않는다.

### 문자열 칼럼을 숫자로 검색

```sql
explain 
select * from test 
where s = 17424528721665;
```

- 위 테이블에서 s는 문자열이다.
- 묵시적인 형변환으로 인해 풀테이블 스캔이 발생한다.
    - 만약 천만건 이상의 데이터 환경에서 테스트하는 경우 성능 저하가 발생한다.

## 정리

- 묵시적 형변환이 발생하면 인덱스의 기능이 무의미해진다.
- 묵시적 형변환은 성능 저하가 발생할 수 있고, 데이터베이스가 자동으로 변환하지 않는 경우 오류가 발생할 수 있기 때문에 명시적인 데이터 유형 변환 방법을 사용하는 것이 좋다.
- 자원낭비가 발생할 수 있으니 명시적으로 사용할 것 (코드리뷰)
    
    ```sql
    혹시 발생하지 않더라도 자동 형변환에 자원이 낭비되니 
    date>='${date}'로 형식을 맞춰주는게 좋을 것 같음
    ```
    

## 참고 자료

- [https://gywn.net/2012/09/dbms-implicit-type-conversion/](https://gywn.net/2012/09/dbms-implicit-type-conversion/)
- [https://velog.io/@gyrbs22/SQLDP-묵시적암시적-형변환](https://velog.io/@gyrbs22/SQLDP-%EB%AC%B5%EC%8B%9C%EC%A0%81%EC%95%94%EC%8B%9C%EC%A0%81-%ED%98%95%EB%B3%80%ED%99%98)
- [https://ceusee.tistory.com/208](https://ceusee.tistory.com/208)