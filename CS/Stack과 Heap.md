조금 더 자세한 내용: https://www.guru99.com/ko/stack-vs-heap.html

잘 설명되어있는 내용: https://leechamin.tistory.com/527

---

## 메모리 구조

- 프로그램이 실행되기 위해서는 먼저 프로그램이 메모리에 로드 되어야 한다.
- 프로그램을 실행시키면 운영체제는 실행한 프로그램을 위해 메모리 공간을 할당하는데, **메모리 공간은 크게 스택, 힙, 데이터 영역으로 나뉜다.**
- 할당되는 장소는 주로 메인 메모리(RAM)이며, 할당되는 용도는 프로그램 실행 시 필요한 메모리 공간을 지정하기 위해서 할당된다.

## 프로그램이 운영체제로부터 할당받는 메모리 공간

![https://leechamin.tistory.com/527](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcHUYfn%2Fbtrc3qzMWIL%2F2kbk8kO3ASQVP5ETqItYeK%2Fimg.png)

https://leechamin.tistory.com/527

### 코드 영역

- 메모리의 코드 영역은 실행할 프로그램의 코드가 저장되는 영역으로, 텍스트 영역이라고도 부른다.
- CPU는 코드 영역에 저장된 명령어를 하나씩 가져가서 처리한다.
- 코드는 우리가 읽을 수 있는 형태가 아닌 기계어로 저장되며, 프로그램 실행에 필요한 코드들이기 때문에 프로그램 실행 ~ 끝까지 메모리에 존재한다.
- 코드 영역은 컴파일 타임에 결정되어 저장되고, 프로그램 실행 도중 우리가 작성한 코드가 변경되는 문제가 생기지 않도록 읽기 전용으로 저장된다.

### 데이터 영역

- 메모리의 데이터 영역은 **프로그램의 전역 변수와 정적(static) 변수**가 저장되는 영역이다.
- 데이터 영역은 **프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 소멸한다.**

### 스택 영역

- 스택 영역은 **컴파일 타임**에 크기가 결정되는 영역이며, 주로 **지역 변수나 매개변수, 반환값 등을 저장한다.**
- 컴파일 타임에 결정되기 때문에 힙 영역과 달리 **동적으로 할당/해제를 해줄 수 없고**, 함수가 실행되면 스택 영역에 올라오며 종료되면 그 함수 내의 매개변수, 지역변수 등이 해제된다.
    - 즉, 함수의 실행/종료에 따라 메모리의 할당/해제 또한 정해진다.
- 스택 영역은 **함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸한다.**
    - 이렇게 스택 영역에 저장되는 함수의 호출 정보를 스택 프레임(stack frame)이라고 한다.
- 스택 영역은 push 동작으로 데이터를 저장하고, pop으로 데이터를 출력한다.
- 이러한 스택은 후입선출(LIFO) 방식에 따라 동작하기 때문에, 가장 늦게 저장된 데이터가 가장 먼저 인출된다.
- 스택 영역은 메모리의 높은 주소에서 낮은 주소의 방향으로 할당된다.

### 힙 영역

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbIH8pr%2FbtrMC0rVEaL%2FS7C0UayMMdsWw8OaCs4h51%2Fimg.png)
https://hooun.tistory.com/193

- 힙 영역은 **사용자에 의해 메모리 공간이 동적으로 할당되고 해제**된다.
    - 따라서 사용자가 동적으로 할당할 수 있는 공간이다.
    - 즉, 컴파일 타임이 아닌 **런타임에 크기가 정해진다.**
- 메모리 할당/해제 작업으로 인해 속도가 저하되는 경향이 있다. (메모리를 직접 관리해줘야한다.)
- 힙 영역은 메모리의 낮은 주소에서 높은 주소의 방향으로 할당된다.
    - 스택과 메모리 공간을 공유하기 때문에 힙 영역이 커지면 스택 영역이 작아지고, 힙 영역이 작아지면 스택 영역이 커진다.
- **Java에서는 가비지 컬렉터를 통해 자동으로 관리되는 영역이다.**
    - 가비지 컬렉터가 없으면 프로그래머가 직접 관리해줘야 한다.
    - 보통 스택보다 큰 메모리를 할당받기 위해 사용한다.
- 힙 영역에는 임의의 객체가 생성되는데, **어떤 객체의 프로퍼티에 값을 저장하거나, 저장된 값을 가져오고 싶은 경우 그 객체의 힙 영역 내의 좌표(주소)를 알고 있어야한다.**
    - 힙 영역에는 클래스 인스턴스와 같은 참조 타입이 저장된다.
- 힙 영역을 두면 하나의 객체를 여러 참조변수에서 공유하는 형태로 사용할 수 있어 메모리 공간을 절약할 수 있다.
- 만약 **객체를 선언하면 항상 힙 메모리 영역에 생성되며, 이러한 객체에 대한 참조 정보는 스택 메모리에 저장된다.**
- 데이터나 프로그램의 크기를 미리 알 수 없는 경우, 스택에 저장하기에 너무 큰 경우 힙 영역에 저장된다. (= 메모리 크기 제한이 없다)

## 스택과 힙의 차이점

![https://hooun.tistory.com/193](https://blog.kakaocdn.net/dn/DOexI/btrMw6t19a4/wxhPz7FYLNnFPc5fVckaA0/img.png)

https://hooun.tistory.com/193

- Stack은 메모리 할당과 할당 해제가 자동으로 수행되며, Heap은 프로그래머가 수동으로 메모리를 할당하고 해제해야한다.
- 스택 메모리의 처리속도가 힙 메모리보다 빠르다.
- 메모리 부족 문제는 일반적으로 스택에서 발생할 가능성이 높다.
- 힙 메모리의 주요 문제는 메모리 조각화(Memory Fragmentation) 또는 메모리 단편화 문제이다.
- 스택은 메모리 영역이 더 작고 캐시 친화적이다.
- 힙 메모리는 메모리 전체에 분산되어 더 많은 캐시 누락(cache miss)을 야기한다.
- 스택은 유연하지 않으며 할당된 메모리의 크기를 변경할 수 없다.

## 참고 자료

- [https://junghyun100.github.io/힙-스택차이점/](https://junghyun100.github.io/%ED%9E%99-%EC%8A%A4%ED%83%9D%EC%B0%A8%EC%9D%B4%EC%A0%90/)
- https://helloworld-japan.tistory.com/33
- https://hooun.tistory.com/193
- https://leechamin.tistory.com/527