## 프로세스와 스레드

- 프로세스는 운영체제로부터 자원을 할당받는 작업의 단위
- 스레드는 프로세스가 할당받은 자원을 이용하는 실행의 단위

## 멀티 프로세스와 멀티 스레드

- 멀티 프로세스와 멀티 스레드는 한 어플리케이션에 대한 처리 방식이다.
    - 단순히 프로그램을 여러개 띄워놓는 것이 아니라 언제 어느때에 어떤 방식으로 처리하느냐에 따라 다른 것으로 이해해야 한다.
- **멀티 스레드**는 멀티 프로세스보다 적은 메모리 공간을 차지하고, 컨텍스트 스위칭이 빠른 장점이 있지만, 동기화 문제와 하나의 스레드 장애로 전체 스레드가 종료될 위험을 갖고 있다.
- **멀티 프로세스**는 하나의 프로세스가 죽더라도 다른 프로세스에 영향을 주지 않아 안정성이 높지만, 멀티 스레드보다 많은 메모리 공간과 CPU 시간을 차지하는 단점이 있다.

## 멀티 프로세스(Multi Process)

- 운영체제에서 하나의 응용 프로그램에 대해 **동시에 여러 개의 프로세스를 실행할 수 있게 하는 기술**
- 보통 하나의 프로그램 실행에 대해 하나의 프로세스가 메모리에 생성되지만, 부가적인 기능을 위해 여러개의 프로세스를 생성한다.
- 하나의 부모 프로세스가 여러 개의 자식 프로세스를 생성함으로써 다중 프로세스를 구성하는 구조이다.
- 한 프로세스는 실행 도중 프로세스 생성 시스템 콜을 통해 세로운 프로세스들을 생성할 수 있다.
    - 다른 프로세스를 생성하는 프로세스를 부모 프로세스라 하고, 다른 프로세스에 의해 생성된 프로세스를 자식 프로세스라 한다.
- 부모 프로세스와 자식 프로세스는 각각 고유한 PID를 가지고 있다.
    - 부모 프로세스는 자식 프로세스의 PID를 알고 있으며, 이를 통해 자식 프로세스를 제어할 수 있다.
    - 자식 프로세스는 부모 프로세스의 PID와 PPID를 알고 있어 부모 프로세스와의 통신이 가능하다.
- 단, 부모 프로세스와 자식 프로세스는 엄연히 서로 다른 프로세스로 독립적으로 실행되며, 독립적인 메모리 공간을 가지고 있어 서로 다른 작업을 수행한다.

### 멀티 프로세스 장점

1. 프로그램 안전성
    
    멀티 프로세스는 각 프로세스가 독립적인 메모리 공간을 가지므로, 한 프로세스가 비정상적으로 종료되어도 다른 프로세스에 영향을 주지 않는다.
    
    따라서 프로그램 전체의 안전성을 확보할 수 있다는 장점이 있다.
    
2. 프로그램 병렬성
    
    다중 CPU 시스템에서 각 프로세스를 병렬적으로 실행하여 성능을 향상시킬 수 있다.
    
3. 시스템 확장성
    
    멀티 프로세스는 각 프로세스가 독립적이므로, 새로운 기능이나 모듈을 추가하거나 수정할 때 다른 프로세스에 영향을 주지 않아 시스템의 규모를 쉽게 확장할 수 있다.
    

### 멀티 프로세스 단점

1. context switching overhead
    
    프로세스를 컨텍스트 스위칭할 경우, cpu는 다음 프로세스의 정보를 불러오기 위해 메모리를 검색하고, cpu 캐시 메모리를 초기화하는 등 빈번한 작업으로 오버헤드가 발생할 수 있다.
    
    스레드를 컨텍스트 스위칭하면 프로세스 스위칭보다 가볍고 좋다.
    
2. 자원 공유 비효율성
    
    멀티 프로세스는 각 프로세스가 독립적인 메모리 공간을 가지므로, 결과적으로 메모리 사용량이 증가하게 된다.
    
    만일 각 프로세스 간의 자원 공유가 필요한 경우 프로세스 사이의 통신 기법인 IPC를 사용해야 한다.
    

## 멀티 스레드(Multi Thread)

- 스레드는 하나의 프로세스 내에 있는 실행 흐름이며, 멀티 스레드는 하나의 프로세스 안에 여러개의 스레드가 있는 것을 말한다.
    - 따라서 하나의 프로그램에서 두 가지 이상의 동작을 동시에 처리하도록 하는 행위가 가능해진다.
- 웹 서버는 대표적인 멀티 스레드 응용 프로그램이다.
    - 사용자가 서버 데이터베이스에 자료를 요청하는 동안 브라우저의 다른 기능을 이용할 수 있는 이유도 바로 멀티 스레드 기능 덕분이다.
    - 즉, 하나의 스레드가 지연되더라도, 다른 스레드는 작업을 지속할 수 있게 된다.

### 멀티 스레드 장점

1. 스레드는 프로세스보다 가볍다.
    
    스레드는 프로세스보다 용량이 가볍다. 스레드는 프로세스 내에서 생성되기 때문에 스레드의 실행 환경을 설정하는 작업이 매우 간단해 생성 및 종료가 빠르다.
    
    스레드를 생성하고 제거할 때 프로세스 내부의 자원만을 관리하면 되기 때문에 프로세스 생성, 제거보다 훨씬 빠르다.
    
2. 자원의 효율성
    
    멀티 스레드는 하나의 프로세스 내에서 여러 개의 스레드를 생성하기 때문에 heap 영역과 같은 공유 메모리에 대해 스레드 간에 자원 공유가 가능하다.
    
    프로세스 간 통신(IPC)을 사용하지 않고도 데이터를 공유할 수 있어 자원의 효율적인 활용이 가능해 시스템 자원 소모가 줄어든다.
    
3. context switching 비용 감소
    
    스레드에도 컨텍스트 스위칭 오버헤드가 존재하지만, 상대적으로 프로세스 컨텍스트 스위칭 오버헤드보다 훨씬 낮아 비용이 낮다는 장점이 있다.
    
    프로세스 컨텍스트 스위칭은 CPU 캐시에 있는 내용을 모두 초기화하고, 새로운 프로세스 정보를 CPU 캐시에 적재해야 하므로 높은 비용이 든다. 반면, 스레드 컨텍스트 스위칭은 스레드 간에 공유하는 자원을 제외한 스레드 정보만을 교체하면 되기 때문에 프로세스 컨텍스트 스위칭 비용보다 상대적으로 낮다.
    
4. 응답 시간 단축
    
    멀티 스레드는 스레드 간의 통신이나 자원 공유가 더욱 용이하며, 프로세스보다 가벼워 컨텍스트 스위칭 오버헤드도 작아 멀티 프로세스보다 응답 시간이 빠르다.
    
    예를 들어, 웹 서버에서 클라이언트 요청을 처리하는 경우, 멀티 프로세스 방식에서는 각 요청마다 프로세스를 생성하여 처리해야 하므로 오버헤드가 크지만, 스레드 방식에서는 여러 개의 스레드가 하나의 프로세스 내에서 요청을 처리할 수 있으므로 오버헤드가 감소해 더욱 빠른 응답 시간을 보장할 수 있다.
    

### 멀티 스레드 단점

1. 안정성 문제
    
    멀티 프로세스 모델에서는 각 프로세스가 독립적으로 동작하므로 하나의 프로세스에서 문제가 발생해도 다른 프로세스들은 영향을 받지 않는다.
    
    하지만, 멀티 스레드 모델에서는 기본적으로 하나의 스레드에서 문제가 발생하면 다른 스레드들도 영향을 받아 전체 프로그램이 종료될 수 있다.
    
2. 동기화로 인한 성능 저하
    
    멀티 스레드 모델은 여러 개의 스레드가 공유 자원에 동시에 접근할 수 있기 때문에, 동기화 문제가 발생할 수 있어 스레드 간 동기화는 데이터 접근을 제어하기 위한 필수적인 기술이다.
    
    동기화 작업은 여러 스레드들이 자원에 대한 접근을 순차적으로 통제하는 것이다. 그러면 동시 접근으로 인한 동시 수정과 같은 현상은 일어나지 않게 된다.
    
3. 데드락 (교착 상태)
    
    다수의 스레드가 같은 lock을 동시에 다른 명령에 의해 획득하려 할 때 서로 절대 불가능한 일을 계속적으로 기다리는 상황을 이야기한다.
    
4. context switching overhead
    
    스레드를 많이 쓸수록 항상 성능이 좋아질까? 라는 물음으로 이어진다.
    
5. 디버깅의 어려움
    
    멀티 스레드를 사용하면, 여러 개의 스레드가 동시에 실행되기 때문에 각 스레드의 동작을 추적하기 어려울 수 있다.
    
    예를 들어, 코드를 디버깅하는 도중에 다른 스레드가 실행되어 예기치 않은 결과가 발생할 수 있고, 어떤 스레드가 언제 어떤 자원에 접근하고 어떤 순서로 실행되는지 등을 파악하기 어렵다.
    

## 멀티 프로세스로 할 수 있는 작업들을 하나의 프로세스에서 스레드로 나누는 이유는 무엇일까?

- 운영체제가 시스템 자원을 효율적으로 관리하기 위해 스레드를 사용한다.
- 멀티 프로세스로 실행되는 작업을 멀티 스레드로 실행할 경우, 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다.
- 또한, 프로세스 간의 통신보다 스레드 간의 통신 비용이 적기 때문에 작업들 간 통신의 부담이 줄어든다.
    - 프로세스는 독립적인 구조이기 때문에 처리 비용이 높다.
- 단, 스레드를 활용하면 자원의 효율성이 증가하긴 하지만, 스레드 간 자원 공유는 전역 변수를 이용하기 때문에 동기화 문제가 발생할 수 있으므로 프로그래머의 주의가 필요하다.

## 참고 자료

- [https://wooody92.github.io/os/멀티-프로세스와-멀티-스레드/](https://wooody92.github.io/os/%EB%A9%80%ED%8B%B0-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EB%A9%80%ED%8B%B0-%EC%8A%A4%EB%A0%88%EB%93%9C/)
- [https://inpa.tistory.com/entry/👩‍💻-multi-process-multi-thread](https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-multi-process-multi-thread)