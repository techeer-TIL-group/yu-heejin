## API Gateway란?

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbjGPUw%2FbtrRCZhz3ed%2Faklfq7RBJWxXyOyHB2F0u1%2Fimg.jpg)

- 많은 서비스들이 MSA 형태로 구축되면서 서비스의 복잡도를 줄일 수 있게 되었고, 변경에 따른 영향을 최소화하면서 개발과 배포를 할 수 있다는 장점도 얻었다.
- 하지만 작은 단위 서비스가 많아질수록 엔드포인트를 관리하는데 있어 어려움이 생기고, 각 서비스마다 공통적으로 들어가는 기능들을 중복으로 개발해야한다는 문제점도 발생한다.
    - 이러한 문제점을 해결하기 위해 등장한 것이 바로 API 게이트웨이이다.
- API Gateway는 클라이언트와 각 서비스들 사이에 위치하게 되는데, **클라이언트는 각 서비스의 엔드포인트 대신 API Gateway로 요청**을 보내게 되며, **요청을 받은 API Gateway는 설정에 따라 각 엔드포인트로 클라이언트를 대신해 요청하고, 응답을 받으면 다시 클라이언트에게 전달하는 프록시 역할**을 한다.
- 모든 서버로의 요청을 단일 지점을 거쳐서 처리하도록 하며, 이를 통해 공통된 로직 처리나 인증 및 인가 처리, 라우팅 처리 등을 할 수 있다.

## API Gateway의 주요 기능

### 인증/인가 및 토큰 발급

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FRPkXR%2FbtrREWSgyr7%2Fv9rNCKPxPUSasM7oNF0fRK%2Fimg.jpg)

- 인증/인가의 경우 각 서비스마다 공통으로 구현되어야하는 필수적인 기능이 된다.
- 각 서비스마다 인증/인가 처리를 구현하는 것이 매우 비효율적이기 때문에 API Gateway에서 이 처리를 하게 된다.
- API 사용을 위한 토큰 발급 기능도 마찬가지 이유로 API Gateway에서 처리되는데, 실제로 토큰 발급 기능은 인증을 위한 서버(인증 서버)를 하나 두고 거기에서 처리되게 한다.

### 공통 로직 처리

- 공통 되는 기능을 각 서비스마다 구현하는 것은 번거로우며 코드 수정이 필요할 때 각각의 서비스를 모두 수정해야하는 등 유지보수 측면에서의 어려움도 존재한다.
- 따라서 **공통 로직의 경우 API Gateway에서 구현되는 것이 효율적**이며, 개발 중복을 줄이는 것뿐만 아니라 표준 준수도 쉽다는 장점을 가지고 있다.

### 로드밸런싱

- 대용량 처리 서비스에 있어서 로드 밸런싱은 필수적인 부분이다.
- 기본적으로 여러 개의 API 서버로 부하를 분산하는 기능이 주가 되겠지만, API 서버에 장애가 발생할 경우 이를 감지해서 로드밸런싱 리스트에서 빼고, 복구되었을 때 다시 로드 밸런싱 리스트에 넣는 기능이 필요하다.

### 메디에이션(Mediation)

- 메디에이션이란 중재 또는 조정이라는 의미를 가지는데, **API 서버가 클라이언트가 원하는 API 형태와 다를 때 API 게이트웨이가 이를 변경해주는 기능을 말한다.**
- 메시지 포맷 변환
    - 메시지 포맷 변환 기능이란 클라이언트에서 들어온 요청을 API 서버로 보낼 때 **데이터를 변환해서 보내주거나 API 서버에서 응답하는 데이터를 클라이언트가 원하는 데이터로 변경**해주는 기능을 의미한다.
- 프로토콜 변환
    - 다양한 서비스 및 클라이언트를 지원하게 되면, 각 서비스 및 클라이언트가 다른 통신 프로토콜을 사용해야 하는 경우가 발생할 수 있다.
        - 예를 들어 웹에서는 JSON, HTTP를 이용한 REST 기반의 통신을 많이 쓰지만, 배나 비행기에서는 REST가 무겁기 때문에 바이너리 기반의 경량 프로토콜을 사용한다.
    - 이렇게 다양한 타입의 프로토콜을 지원하기 위해 프로토콜마다 새로운 서비스를 구현하는 것이 아니라 API 게이트웨이에서 프로토콜 변환을 이용해 서비스를 호출할 수 있도록 한다.
- 메시지 호출 패턴 변환
    - 메시지 호출 패턴 변환이란 동기 비동기 호출같은 통신을 변경시킬 수 있다.
    - API 클라이언트는 동기 호출을 했지만 API 게이트웨이에서는 메시지 큐 서비스를 이용해 비동기 통신을 이용해 요청을 처리해주고 응답을 줄 수 있다.

## 참고 자료

- https://wildeveloperetrain.tistory.com/205
- https://kinchi22.github.io/2019/09/22/api-gateway/
- [https://velog.io/@youngerjesus/API-Gateway의-이해](https://velog.io/@youngerjesus/API-Gateway%EC%9D%98-%EC%9D%B4%ED%95%B4)